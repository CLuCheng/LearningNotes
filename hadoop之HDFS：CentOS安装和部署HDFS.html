<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>hadoop之HDFS：CentOS安装和部署HDFS</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="2gpo" id="hadoop之hdfscentos安装和部署hdfs">hadoop之HDFS：CentOS安装和部署HDFS</h1><hr><div class="md-section-divider"></div><h2 data-anchor-id="w2pa" id="一准备工作">一、准备工作</h2><ol data-anchor-id="a57e">
<li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank">下载 jdk</a>  </li>
<li><p><a href="http://www.apache.org/dyn/closer.cgi/hadoop/common/" target="_blank">下载 Hadoop</a></p>

<p><img src="http://img.blog.csdn.net/20170930144643568?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFpZHVfMzIyMzc3MTk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="下载好的jdk和Hadoop" title=""></p></li>
</ol><div class="md-section-divider"></div><h2 data-anchor-id="kcel" id="二安装jdkhadoop及配置环境变量">二、安装JDK、Hadoop及配置环境变量</h2><div class="md-section-divider"></div><h4 data-anchor-id="pnzr" id="安装jdk">安装JDK</h4><p data-anchor-id="m85l">进入 /usr/lib/java-1.8.0，把压缩包jdk-8u144-linux-x64.tar.gz移动到该目录，并解压</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="a0dy"><ol class="linenums"><li class="L0"><code><span class="pln"> cd </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">java</span><span class="pun">-</span><span class="lit">1.8</span><span class="pun">.</span><span class="lit">0</span></code></li><li class="L1"><code><span class="pln"> tar zxf </span><span class="pun">./</span><span class="pln">jdk</span><span class="pun">-</span><span class="lit">8u144</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">x64</span><span class="pun">.</span><span class="pln">tar</span><span class="pun">.</span><span class="pln">gz </span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="1blm" id="安装hadoop">安装Hadoop</h4><p data-anchor-id="39vw">进入 /opt/hadoop目录，把压缩包hadoop-2.8.1.tar.gz移动到该目录，并解压 </p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ltmt"><ol class="linenums"><li class="L0"><code><span class="pln"> cd </span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">hadoop</span></code></li><li class="L1"><code><span class="pln"> tar zxf </span><span class="pun">./</span><span class="pln">hadoop</span><span class="pun">-</span><span class="lit">2.8</span><span class="pun">.</span><span class="lit">1.tar</span><span class="pun">.</span><span class="pln">gz</span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="6w8x" id="配置环境变量">配置环境变量</h4><p data-anchor-id="y3z1">配置环境，编辑 /etc/profile 文件</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="pdme"><ol class="linenums"><li class="L0"><code><span class="pln">vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">profile</span></code></li></ol></pre><p data-anchor-id="w8jc">在其后添加如下信息：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="0xvm"><ol class="linenums"><li class="L0"><code><span class="kwd">export</span><span class="pln"> JAVA_HOME</span><span class="pun">=</span><span class="str">/usr/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">java</span><span class="pun">-</span><span class="lit">1.8</span><span class="pun">.</span><span class="lit">0</span><span class="pun">/</span><span class="pln">jdk1</span><span class="pun">.</span><span class="lit">8.0</span><span class="pln">_144</span></code></li><li class="L1"><code><span class="kwd">export</span><span class="pln"> HADOOP_HOME</span><span class="pun">=</span><span class="str">/opt/</span><span class="pln">hadoop</span><span class="pun">/</span><span class="pln">hadoop</span><span class="pun">-</span><span class="lit">2.8</span><span class="pun">.</span><span class="lit">1</span></code></li><li class="L2"><code><span class="pln">PATH</span><span class="pun">=</span><span class="pln">$JAVA_HOME</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">:</span><span class="pln">$PATH</span><span class="pun">:</span><span class="pln">$</span><span class="pun">{</span><span class="pln">HADOOP_HOME</span><span class="pun">}/</span><span class="pln">bin</span><span class="pun">:</span><span class="pln">$</span><span class="pun">{</span><span class="pln">HADOOP_HOME</span><span class="pun">}/</span><span class="pln">sbin</span></code></li><li class="L3"><code><span class="pln">CLASSPATH</span><span class="pun">=</span><span class="pln">$JAVA_HOME</span><span class="pun">/</span><span class="pln">jre</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">ext</span><span class="pun">:</span><span class="pln">$JAVA_HOME</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">tools</span><span class="pun">.</span><span class="pln">jar</span></code></li><li class="L4"><code><span class="kwd">export</span><span class="pln"> PATH JAVA_HOME </span><span class="typ">CLASSPATHo</span></code></li></ol></pre><p data-anchor-id="7z5u">JAVA_HOME jdk的路径 <br>
HADOOP_HOME hadoop路径 <br>
使配置的变量生效：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="gfe7"><ol class="linenums"><li class="L0"><code><span class="pln">source </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">profile</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="hgjf" id="三ssh无密码登录">三、SSH无密码登录</h2><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="9let"><ol class="linenums"><li class="L0"><code><span class="pln">$ ssh</span><span class="pun">-</span><span class="pln">keygen </span><span class="pun">-</span><span class="pln">t dsa </span><span class="pun">-</span><span class="pln">P </span><span class="str">''</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f </span><span class="pun">~</span><span class="str">/.ssh/</span><span class="pln">id_dsa</span></code></li><li class="L1"><code><span class="pln">$ cat </span><span class="pun">~</span><span class="str">/.ssh/</span><span class="pln">id_dsa</span><span class="pun">.</span><span class="pln">pub </span><span class="pun">&gt;&gt;</span><span class="pln"> </span><span class="pun">~</span><span class="str">/.ssh/</span><span class="pln">authorized_keys</span></code></li></ol></pre><p data-anchor-id="wg8z">验证ssh，<code># ssh localhost</code>  <br>
不需要输入密码即可登录。</p><div class="md-section-divider"></div><h2 data-anchor-id="4o0p" id="四hadoop的伪分布式环境搭建">四、Hadoop的伪分布式环境搭建</h2><p data-anchor-id="wwfr">Hadoop 伪分布式模式是在一台机器上模拟Hadoop分布式，单机上的分布式并不是真正的分布式，而是使用线程模拟的分布式。分布式和伪分布式这两种配置也很相似，唯一不同的地方是伪分布式是在一台机器上配置，也就是名字节点（namenode）和数据节点（datanode）均是同一台机器。</p><p data-anchor-id="lp1w">需要配置的文件有core-site.xml和hdfs-site.xml这两个文件他们都位于${HADOOP_HOME}/etc/hadoop/文件夹下。 </p><div class="md-section-divider"></div><h4 data-anchor-id="p9i6" id="core-sitexml">core-site.xml：</h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="xln4"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;configuration&gt;</span></code></li><li class="L1"><code><span class="pln"> </span><span class="tag">&lt;property&gt;</span></code></li><li class="L2"><code><span class="pln">     </span><span class="tag">&lt;name&gt;</span><span class="pln">hadoop.tmp.dir</span><span class="tag">&lt;/name&gt;</span></code></li><li class="L3"><code><span class="pln">      </span><span class="tag">&lt;value&gt;</span><span class="pln">file:/opt/hadoop/hadoop-2.8.1/tmp</span><span class="tag">&lt;/value&gt;</span></code></li><li class="L4"><code><span class="pln">      </span><span class="tag">&lt;description&gt;</span><span class="pln">Abase for other temporary directories.</span><span class="tag">&lt;/description&gt;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="tag">&lt;/property&gt;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="tag">&lt;property&gt;</span></code></li><li class="L7"><code><span class="pln">      </span><span class="tag">&lt;name&gt;</span><span class="pln">fs.defaultFS</span><span class="tag">&lt;/name&gt;</span></code></li><li class="L8"><code><span class="pln">      </span><span class="tag">&lt;value&gt;</span><span class="pln">hdfs://192.168.3.39:9000</span><span class="tag">&lt;/value&gt;</span></code></li><li class="L9"><code><span class="pln">        </span><span class="tag">&lt;final&gt;</span><span class="pln">true</span><span class="tag">&lt;/final&gt;</span></code></li><li class="L0"><code><span class="pln"> </span><span class="tag">&lt;/property&gt;</span></code></li><li class="L1"><code><span class="tag">&lt;/configuration&gt;</span></code></li></ol></pre><p data-anchor-id="jyic">fs.defaultFS的value修改为本机的ip地址</p><div class="md-section-divider"></div><h4 data-anchor-id="3y7y" id="hdfs-sitexml">hdfs-site.xml：</h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="l7kf"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;configuration&gt;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="tag">&lt;property&gt;</span></code></li><li class="L2"><code><span class="pln">      </span><span class="tag">&lt;name&gt;</span><span class="pln">dfs.replication</span><span class="tag">&lt;/name&gt;</span></code></li><li class="L3"><code><span class="pln">      </span><span class="tag">&lt;value&gt;</span><span class="pln">1</span><span class="tag">&lt;/value&gt;</span></code></li><li class="L4"><code><span class="pln">    </span><span class="tag">&lt;/property&gt;</span></code></li><li class="L5"><code><span class="pln">    </span><span class="tag">&lt;property&gt;</span></code></li><li class="L6"><code><span class="pln">      </span><span class="tag">&lt;name&gt;</span><span class="pln">dfs.namenode.name.dir</span><span class="tag">&lt;/name&gt;</span></code></li><li class="L7"><code><span class="pln">      </span><span class="tag">&lt;value&gt;</span><span class="pln">file:/opt/hadoop/hadoop-2.8.1/tmp/dfs/name</span><span class="tag">&lt;/value&gt;</span></code></li><li class="L8"><code><span class="pln">   </span><span class="tag">&lt;/property&gt;</span></code></li><li class="L9"><code><span class="pln">    </span><span class="tag">&lt;property&gt;</span></code></li><li class="L0"><code><span class="pln">      </span><span class="tag">&lt;name&gt;</span><span class="pln">dfs.datanode.data.dir</span><span class="tag">&lt;/name&gt;</span></code></li><li class="L1"><code><span class="pln">      </span><span class="tag">&lt;value&gt;</span><span class="pln">file:/opt/hadoop/hadoop-2.8.1/tmp/dfs/data</span><span class="tag">&lt;/value&gt;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="tag">&lt;/property&gt;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="tag">&lt;property&gt;</span></code></li><li class="L4"><code><span class="pln">      </span><span class="tag">&lt;name&gt;</span><span class="pln">dfs.namenode.http-address</span><span class="tag">&lt;/name&gt;</span></code></li><li class="L5"><code><span class="pln">      </span><span class="tag">&lt;value&gt;</span><span class="pln">master:50070</span><span class="tag">&lt;/value&gt;</span></code></li><li class="L6"><code><span class="pln">      </span><span class="tag">&lt;name&gt;</span><span class="pln">dfs.permissions</span><span class="tag">&lt;/name&gt;</span></code></li><li class="L7"><code><span class="pln">      </span><span class="tag">&lt;value&gt;</span><span class="pln">false</span><span class="tag">&lt;/value&gt;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="tag">&lt;/property&gt;</span></code></li><li class="L9"><code><span class="tag">&lt;/configuration&gt;</span></code></li></ol></pre><div class="md-section-divider"></div><h4 data-anchor-id="xakd" id="修改etchosts">修改/etc/hosts</h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="lhe8"><ol class="linenums"><li class="L0"><code><span class="lit">127.0</span><span class="pun">.</span><span class="lit">0.1</span><span class="pln">   localhost localhost</span><span class="pun">.</span><span class="pln">localdomain localhost4 localhost4</span><span class="pun">.</span><span class="pln">localdomain4 yodosmart</span><span class="pun">.</span><span class="pln">hdfs</span><span class="pun">.</span><span class="lit">01</span></code></li><li class="L1"><code><span class="lit">192.168</span><span class="pun">.</span><span class="lit">3.39</span><span class="pln">   master</span></code></li><li class="L2"><code><span class="pun">::</span><span class="lit">1</span><span class="pln">         localhost localhost</span><span class="pun">.</span><span class="pln">localdomain localhost6 localhost6</span><span class="pun">.</span><span class="pln">localdomain6 yodosmart</span><span class="pun">.</span><span class="pln">hdfs</span><span class="pun">.</span><span class="lit">01</span></code></li></ol></pre><p data-anchor-id="vn8h">在/etc/hosts中添加DHCP获取或者自己设置的IP地址 到localhost主机名的映射.这种方式是基于主机名称的访问，对于ip访问无效 <br>
查看当前主机名<code># hostname</code></p><div class="md-section-divider"></div><h4 data-anchor-id="99jm" id="开放9000端口">开放9000端口</h4><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="yz14"><ol class="linenums"><li class="L0"><code><span class="com">#开放9000端口</span></code></li><li class="L1"><code><span class="pln">iptables </span><span class="pun">-</span><span class="pln">I INPUT </span><span class="pun">-</span><span class="pln">p tcp </span><span class="pun">-</span><span class="pln">m tcp </span><span class="pun">--</span><span class="pln">dport </span><span class="lit">9000</span><span class="pln"> </span><span class="pun">-</span><span class="pln">m state </span><span class="pun">--</span><span class="pln">state NEW</span><span class="pun">,</span><span class="pln">ESTABLISHED </span><span class="pun">-</span><span class="pln">j ACCEPT</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="com">#重启防火墙</span></code></li><li class="L4"><code><span class="pln">service iptables save </span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="com">#保存iptables</span></code></li><li class="L7"><code><span class="pln">service iptables restart</span></code></li></ol></pre><p data-anchor-id="mffp">如果需要访问web管理页面，还需要开发50070端口</p><div class="md-section-divider"></div><h4 data-anchor-id="d370" id="格式化hdfs">格式化hdfs</h4><p data-anchor-id="9zz9">配置完成后，执行格式化命令，使HDFS的目录进行格式化：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="x0iy"><ol class="linenums"><li class="L0"><code><span class="pln">    hdfs namenode </span><span class="pun">-</span><span class="pln">format</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="0j5t" id="五启动hdfs">五、启动HDFS</h2><p data-anchor-id="1ice">启动HDFS的脚本位于Hadoop目录下的sbin文件夹中 <br>
移动到hdfs主目录</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="rd7s"><ol class="linenums"><li class="L0"><code><span class="pln">sbin</span><span class="pun">/</span><span class="pln">start</span><span class="pun">-</span><span class="pln">dfs</span><span class="pun">.</span><span class="pln">sh </span><span class="com"># 启动HDFS脚本</span></code></li></ol></pre><p data-anchor-id="92zd">在执行start-dfs.sh脚本启动HDFS时，可能出现类似如下的报错内容：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="i9ls"><ol class="linenums"><li class="L0"><code><span class="pln">  localhost</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Error</span><span class="pun">:</span><span class="pln"> JAVA_HOME </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">set</span><span class="pln"> </span><span class="kwd">and</span><span class="pln"> could </span><span class="kwd">not</span><span class="pln"> be found</span><span class="pun">.</span></code></li></ol></pre><p data-anchor-id="t3zr">JAVA_HOME没找到，这是因为在hadoop-env.sh脚本中有个<code>JAVA_HOME=${JAVA_HOME}</code>，所以只需将<code>${JAVA_HOME}</code>替换成JDK的路径：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="fegm"><ol class="linenums"><li class="L0"><code><span class="pln">vim </span><span class="pun">/</span><span class="pln">etc</span><span class="pun">/</span><span class="pln">hadoop</span><span class="pun">/</span><span class="pln">hadoop</span><span class="pun">-</span><span class="pln">env</span><span class="pun">.</span><span class="pln">sh</span></code></li></ol></pre><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ejyl"><ol class="linenums"><li class="L0"><code><span class="kwd">export</span><span class="pln"> JAVA_HOME</span><span class="pun">=</span><span class="str">/usr/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">java</span><span class="pun">-</span><span class="lit">1.8</span><span class="pun">.</span><span class="lit">0</span><span class="pun">/</span><span class="pln">jdk1</span><span class="pun">.</span><span class="lit">8.0</span><span class="pln">_144</span></code></li></ol></pre><p data-anchor-id="dqub">查看是否启动成功</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="f34a"><ol class="linenums"><li class="L0"><code><span class="pln">jps</span></code></li></ol></pre><p data-anchor-id="p2zn">成功的话如下</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="g8if"><ol class="linenums"><li class="L0"><code><span class="lit">7617</span><span class="pln"> </span><span class="typ">Jps</span></code></li><li class="L1"><code><span class="lit">8214</span><span class="pln"> </span><span class="typ">DataNode</span></code></li><li class="L2"><code><span class="lit">8393</span><span class="pln"> </span><span class="typ">SecondaryNameNode</span></code></li><li class="L3"><code><span class="lit">8074</span><span class="pln"> </span><span class="typ">NameNode</span></code></li></ol></pre><p data-anchor-id="2e7o">关闭</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="p6e7"><ol class="linenums"><li class="L0"><code><span class="pln">sbin</span><span class="pun">/</span><span class="pln">stop</span><span class="pun">-</span><span class="pln">dfs</span><span class="pun">.</span><span class="pln">sh</span></code></li></ol></pre><p data-anchor-id="09hn">当成功启动之后，可以在浏览器通过访问网址<a href="http://192.168.3.39:50070/" target="_blank">http://192.168.3.39:50070/</a></p><p data-anchor-id="28kx"><img src="http://img.blog.csdn.net/20170930154521140?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvYmFpZHVfMzIyMzc3MTk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="hdfs成功" title=""></p></div>
</body>
</html>